# ğŸ” MicroserviÃ§o de AutenticaÃ§Ã£o

Um microserviÃ§o de autenticaÃ§Ã£o **enterprise-grade** construÃ­do com Node.js, Express e JWT. Inclui clustering, cache Redis, mÃ©tricas Prometheus e documentaÃ§Ã£o Swagger completa.

## ğŸ¯ **CaracterÃ­sticas Principais**

### **ğŸš€ Performance & Escalabilidade**
- **Clustering automÃ¡tico** - utiliza todos os cores da CPU
- **Load balancing** interno do Node.js
- **Cache Redis** para tokens JWT
- **Rate limiting** avanÃ§ado
- **Compression** habilitada

### **ğŸ”’ SeguranÃ§a**
- **JWT** com expiraÃ§Ã£o configurÃ¡vel
- **Bcrypt** para hash de senhas
- **HTTPS** obrigatÃ³rio
- **Rate limiting** por IP
- **ValidaÃ§Ã£o** rigorosa de entrada

### **ğŸ“Š Observabilidade**
- **MÃ©tricas Prometheus** completas
- **Logs estruturados** por worker
- **Health monitoring** integrado
- **Request tracing** detalhado

### **ğŸ› ï¸ Operacional**
- **Graceful shutdown** implementado
- **Error handling** robusto
- **Hot reload** com PM2

### **ğŸš¢ CI/CD & DevOps**
- **Pipeline GitHub Actions** completo
- **Docker multi-stage** build otimizado
- **Testes automatizados** (unitÃ¡rios, integraÃ§Ã£o, carga)
- **Security scanning** com Trivy
- **Deploy blue-green** para staging/production
- **Backup/restore** automatizado
- **Performance testing** integrado
- **Docker ready**


```env
# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-here
JWT_EXPIRES=6h

# Database
URI_MONGODB=mongodb://admin:password@localhost:27017/auth?authSource=admin

# Redis Cache
REDIS_HOST=localhost
REDIS_PORT=6379

# Server
PORT=3000
NODE_ENV=production

# Rate Limiting
RATE_LIMIT_WINDOW=15
RATE_LIMIT_MAX=50
LOGIN_LIMIT_MAX=5
```

## ğŸ“– **API Documentation**

### **ğŸ“ Endpoints DisponÃ­veis**

| MÃ©todo | Endpoint | DescriÃ§Ã£o | Auth |
|--------|----------|-----------|------|
| `POST` | `/login` | AutenticaÃ§Ã£o do usuÃ¡rio | âŒ |
| `POST` | `/register` | Registro de novo usuÃ¡rio | âŒ |
| `GET` | `/profile` | Dados do usuÃ¡rio logado | âœ… |
| `PUT` | `/update` | Atualizar perfil | âœ… |
| `DELETE` | `/delete` | Remover conta | âœ… |
| `GET` | `/metrics` | MÃ©tricas Prometheus | âŒ |
| `GET` | `/health` | Health check do serviÃ§o | âŒ |

```bash
# 1. Login
curl -X POST https://localhost:3000/login \
  -H "Content-Type: application/json" \
  -d '{"user": "admin", "password": "senha123"}' \
  -k
```

### **ğŸ“š Swagger UI**

Acesse a documentaÃ§Ã£o interativa completa:
- **Desenvolvimento:** https://localhost:3000/api-docs
- **ProduÃ§Ã£o:** https://your-domain.com/api-docs

### **ğŸ“ Exemplos de Request/Response**

<details>
<summary><strong>POST /register</strong></summary>

```javascript
// Request
{
  "user": "novo_usuario",
  "password": "senhaSegura123"
}

// Response 201
{
  "message": "UsuÃ¡rio registrado com sucesso"
}

// Response 409 (Conflict)
{
  "message": "UsuÃ¡rio jÃ¡ existe."
}
```

## ğŸ—ï¸ **Arquitetura**

### **ğŸ—‚ï¸ Estrutura do Projeto**

```
src/
â”œâ”€â”€ app.js                 # AplicaÃ§Ã£o principal + clustering
â”œâ”€â”€ config/                # ConfiguraÃ§Ãµes
â”‚   â”œâ”€â”€ cache.js          # Redis setup
â”‚   â”œâ”€â”€ database.js       # MongoDB connection
â”‚   â”œâ”€â”€ passport.js       # Authentication strategy
â”‚   â”œâ”€â”€ rateLimiting.js   # Rate limiting config
â”‚   â””â”€â”€ swagger.js        # API documentation
â”œâ”€â”€ controllers/          # Business logic
â”‚   â””â”€â”€ authController.js # Auth operations
â”œâ”€â”€ middleware/           # Express middlewares
â”‚   â”œâ”€â”€ auth.js          # JWT verification
â”‚   â”œâ”€â”€ requestLogger.js # Request logging
â”‚   â””â”€â”€ validation.js    # Input validation
â”œâ”€â”€ models/              # Database models
â”‚   â””â”€â”€ User.js         # User schema
â”œâ”€â”€ routes/             # API routes
â”‚   â””â”€â”€ authRoutes.js  # Authentication routes
â””â”€â”€ utils/             # Utilities
    â”œâ”€â”€ errorHandler.js # Error handling
    â””â”€â”€ metrics.js     # Prometheus metrics
```

### **âš–ï¸ Load Balancing**

O Node.js Cluster distribui automaticamente as requisiÃ§Ãµes:

```javascript
// 4 CPU cores = 4 workers
Worker 1: Handles requests 1, 5, 9, 13...
Worker 2: Handles requests 2, 6, 10, 14...
Worker 3: Handles requests 3, 7, 11, 15...
Worker 4: Handles requests 4, 8, 12, 16...
```

---

## ğŸ“Š **Monitoramento**

### **ğŸ¯ MÃ©tricas Prometheus**

Acesse: https://localhost:3000/metrics

```prometheus
# MÃ©tricas do sistema
nodejs_eventloop_lag_seconds          # Event loop lag
nodejs_process_cpu_seconds_total      # CPU usage
nodejs_process_resident_memory_bytes  # Memory usage

# MÃ©tricas da aplicaÃ§Ã£o
http_requests_total                   # Total requests
http_request_duration_seconds         # Request duration
app_start_time_seconds               # Application uptime
```

### **ğŸ“Š Observabilidade**
- **MÃ©tricas Prometheus** completas
- **Logs estruturados** por worker  
- **Health check endpoint** (`/health`) âœ…
- **Dependency monitoring** (MongoDB, Redis)
- **Resource monitoring** (CPU, Memory, Uptime)
- **Request tracing** detalhado


### **ğŸ“Š Logs Estruturados**

```bash
# PM2 logs em tempo real
pm2 logs autenticacao --lines 100

# Exemplo de log
ğŸ“¥ Worker 12345 processou: POST /login
ğŸ“Š MÃ©trica registrada: POST /login 200
âœ… Login bem-sucedido. Token gerado: eyJ...
```

## ğŸ™ **Agradecimentos**

- **Express.js** - Framework web
- **Passport.js** - EstratÃ©gias de autenticaÃ§Ã£o
- **Prometheus** - Sistema de mÃ©tricas
- **MongoDB** - Banco de dados NoSQL
- **Redis** - Cache em memÃ³ria

---

# ğŸ” MicroserviÃ§o de AutenticaÃ§Ã£o

OlÃ¡! ğŸ‘‹ Sou **Dioney Froes**, desenvolvedor fullstack, e este Ã© meu projeto de um microserviÃ§o de autenticaÃ§Ã£o enterprise construÃ­do com Node.js. 

Este projeto foi desenvolvido entre **Junho e julho de 2025** com a valiosa assistÃªncia da IA do GitHub Copilot, demonstrando como a colaboraÃ§Ã£o entre humanos e IA pode criar soluÃ§Ãµes robustas e escalÃ¡veis.

**O que vocÃª encontrarÃ¡ aqui:**
- Sistema de autenticaÃ§Ã£o JWT completo e seguro
- Arquitetura hexagonal bem estruturada  
- Clustering automÃ¡tico para alta performance
- Sistema de seguranÃ§a avanÃ§ado com monitoramento de ameaÃ§as
- Testes automatizados abrangentes
- DocumentaÃ§Ã£o completa e prÃ¡tica

## ğŸ¯ **Por que Este Projeto?**

Como desenvolvedor fullstack, sempre busquei criar soluÃ§Ãµes que nÃ£o apenas funcionem, mas que sejam **verdadeiramente prontas para produÃ§Ã£o**. Este microserviÃ§o nasceu da necessidade de ter um sistema de autenticaÃ§Ã£o que pudesse:

- Escalar automaticamente conforme a demanda
- Resistir a ataques e tentativas de invasÃ£o
- Ser facilmente mantido e expandido
- Fornecer observabilidade completa para troubleshooting

### **ğŸš€ Performance & Escalabilidade**
- **Clustering automÃ¡tico** - aproveita todos os cores da CPU disponÃ­veis
- **Load balancing** nativo do Node.js entre workers
- **Cache Redis** para tokens JWT (com fallback em memÃ³ria)
- **Rate limiting** inteligente que se adapta Ã  carga
- **CompressÃ£o** de resposta para reduzir latÃªncia

### **ğŸ”’ SeguranÃ§a que Funciona de Verdade**
NÃ£o Ã© sÃ³ sobre JWT e bcrypt. Implementei um sistema completo que:
- **Monitora ameaÃ§as** em tempo real (XSS, SQLi, DDoS, path traversal)
- **Bloqueia IPs suspeitos** automaticamente
- **Sanitiza todas as entradas** recursivamente
- **Auditoria completa** de eventos de seguranÃ§a
- **Dashboard prÃ³prio** para monitoramento (/security/*)
- **Headers de seguranÃ§a** otimizados com Helmet

### **ğŸ“Š Observabilidade que Salva Vidas**
Quando algo dÃ¡ errado (e sempre dÃ¡), vocÃª precisa saber **exatamente** o que aconteceu:
- **MÃ©tricas Prometheus** detalhadas de performance
- **Logs estruturados** com contexto por worker
- **Health check** inteligente que testa dependÃªncias
- **Tracing** completo de requisiÃ§Ãµes para debug

### **ğŸ› ï¸ Arquitetura que Faz Sentido**
Apliquei **arquitetura hexagonal** (ports & adapters) porque acredito que cÃ³digo bom Ã© cÃ³digo que vocÃª consegue entender 6 meses depois:
- **Core isolado** com lÃ³gica de negÃ³cio pura
- **Dependency Injection** real, nÃ£o gambiarra
- **ConfiguraÃ§Ã£o centralizada** que nÃ£o te deixa louco
- **Graceful shutdown** porque aplicaÃ§Ã£o que trava Ã© dor de cabeÃ§a

### **âš¡ Ferramentas de Desenvolvimento**
- **Hot reload** com PM2 (salva tempo de desenvolvimento)
- **ESLint** configurado (mantÃ©m o cÃ³digo limpo)
- **Docker** pronto para usar (funciona na minha mÃ¡quina E na sua)
- **Testes automatizados** que realmente testam coisas importantes


## âš™ï¸ **ConfiguraÃ§Ã£o RÃ¡pida**

```bash
# 1. Clone o repositÃ³rio
git clone https://github.com/dioney/microservices-auth.git
cd microservices-auth

# 2. Instale as dependÃªncias  
npm install

# 3. Configure as variÃ¡veis de ambiente
cp .env.example .env
# Edite o .env com suas configuraÃ§Ãµes

# 4. Inicie os serviÃ§os (MongoDB + Redis)
docker-compose up -d

# 5. Rode em desenvolvimento
npm run dev

# 6. Acesse a documentaÃ§Ã£o
# https://localhost:3000/api-docs
```

### **ğŸ“‹ VariÃ¡veis de Ambiente Essenciais**

```env
# JWT Configuration (OBRIGATÃ“RIO)
JWT_SECRET=your-super-secret-jwt-key-here-minimum-32-chars
JWT_EXPIRES=6h

# Database (OBRIGATÃ“RIO)  
URI_MONGODB=mongodb://admin:password@localhost:27017/auth?authSource=admin

# Redis Cache (OPCIONAL - tem fallback em memÃ³ria)
REDIS_HOST=localhost
REDIS_PORT=6379

# Server
PORT=3000
NODE_ENV=development

# Rate Limiting (OPCIONAL - tem valores padrÃ£o)
RATE_LIMIT_IP_POINTS=100
RATE_LIMIT_LOGIN_POINTS=5
```

## ğŸ“– **API Documentation**

### **ğŸ“ Endpoints DisponÃ­veis**

| MÃ©todo | Endpoint | DescriÃ§Ã£o | Auth |
|--------|----------|-----------|------|
| `POST` | `/login` | AutenticaÃ§Ã£o do usuÃ¡rio | âŒ |
| `POST` | `/register` | Registro de novo usuÃ¡rio | âŒ |
| `GET` | `/profile` | Dados do usuÃ¡rio logado | âœ… |
| `PUT` | `/update` | Atualizar perfil | âœ… |
| `DELETE` | `/delete` | Remover conta | âœ… |
| `GET` | `/metrics` | MÃ©tricas Prometheus | âŒ |
| `GET` | `/health` | Health check do serviÃ§o | âŒ |

```bash
# 1. Login
curl -X POST https://localhost:3000/login \
  -H "Content-Type: application/json" \
  -d '{"user": "admin", "password": "senha123"}' \
  -k
```

### **ğŸ“š Swagger UI**

Acesse a documentaÃ§Ã£o interativa completa:
- **Desenvolvimento:** https://localhost:3000/api-docs
- **ProduÃ§Ã£o:** https://your-domain.com/api-docs

### **ğŸ“ Exemplos de Request/Response**

<details>
<summary><strong>POST /register</strong></summary>

```javascript
// Request
{
  "user": "novo_usuario",
  "password": "senhaSegura123"
}

// Response 201
{
  "message": "UsuÃ¡rio registrado com sucesso"
}

// Response 409 (Conflict)
{
  "message": "UsuÃ¡rio jÃ¡ existe."
}
```

## ğŸ—ï¸ **Como EstÃ¡ Organizado**

Passei um tempo pensando na estrutura porque acredito que projeto bem organizado Ã© projeto que escala. Aqui estÃ¡ o que vocÃª vai encontrar:

```
src/
â”œâ”€â”€ ğŸš€ app.js                    # Ponto de entrada + clustering
â”œâ”€â”€ ğŸ§  core/                     # CoraÃ§Ã£o da aplicaÃ§Ã£o
â”‚   â”œâ”€â”€ domain.js               # Entidades e regras de negÃ³cio
â”‚   â”œâ”€â”€ bootstrap.js            # DI container e configuraÃ§Ã£o  
â”‚   â””â”€â”€ ServiceContainer.js     # Gerenciamento de dependÃªncias
â”œâ”€â”€ ğŸ”Œ adapters/                 # ImplementaÃ§Ãµes de infraestrutura
â”‚   â””â”€â”€ index.js                # Adapters para crypto, tokens, logs
â”œâ”€â”€ ğŸŒ web/                      # Camada de apresentaÃ§Ã£o HTTP
â”‚   â”œâ”€â”€ AuthController.js       # Controllers HTTP
â”‚   â””â”€â”€ AuthMiddleware.js       # Middleware de autenticaÃ§Ã£o
â”œâ”€â”€ âš™ï¸  config/                  # ConfiguraÃ§Ãµes centralizadas
â”‚   â”œâ”€â”€ appConfig.js            # ConfiguraÃ§Ã£o principal
â”‚   â”œâ”€â”€ env.js                  # ValidaÃ§Ã£o de ambiente
â”‚   â”œâ”€â”€ cache.js                # Setup Redis
â”‚   â”œâ”€â”€ passport.js             # EstratÃ©gia de autenticaÃ§Ã£o
â”‚   â””â”€â”€ swagger.js              # DocumentaÃ§Ã£o API
â”œâ”€â”€ ğŸ›¡ï¸  middleware/              # Middlewares de seguranÃ§a
â”‚   â”œâ”€â”€ securityMonitoring.js   # DetecÃ§Ã£o de ameaÃ§as
â”‚   â”œâ”€â”€ securityAudit.js        # Auditoria de eventos
â”‚   â”œâ”€â”€ advancetRateLimit.js    # Rate limiting inteligente
â”‚   â””â”€â”€ sanitization.js         # Limpeza de entrada
â”œâ”€â”€ ğŸ“Š models/                   # Modelos de dados
â”‚   â””â”€â”€ User.js                 # Schema do usuÃ¡rio
â”œâ”€â”€ ğŸ›¤ï¸  routes/                  # DefiniÃ§Ã£o de rotas
â”‚   â”œâ”€â”€ authRoutes.js           # Rotas de autenticaÃ§Ã£o
â”‚   â””â”€â”€ securityRoutes.js       # Dashboard de seguranÃ§a
â””â”€â”€ ğŸ”§ utils/                    # UtilitÃ¡rios
    â”œâ”€â”€ metrics.js              # MÃ©tricas Prometheus
    â”œâ”€â”€ healthCheck.js          # VerificaÃ§Ã£o de saÃºde
    â””â”€â”€ errorHandler.js         # Tratamento de erros
```

### **ğŸ¤” Por que Arquitetura Hexagonal?**

Porque jÃ¡ cansei de ver projetos onde vocÃª nÃ£o consegue testar nada sem subir o banco inteiro. Aqui:
- **Core** nÃ£o sabe que HTTP existe (pode virar CLI amanhÃ£)
- **Adapters** fazem a ponte com o mundo externo
- **Testes** sÃ£o rÃ¡pidos porque mockam apenas as bordas
- **MudanÃ§as** de infraestrutura nÃ£o quebram a lÃ³gica de negÃ³cio

### **âš–ï¸ Como Funciona o Load Balancing**

O Node.js faz isso automaticamente com cluster, mas Ã© legal entender:

```javascript
// Com 4 cores = 4 workers rodando em paralelo
Worker 1: Processa requisiÃ§Ãµes 1, 5, 9, 13...
Worker 2: Processa requisiÃ§Ãµes 2, 6, 10, 14...  
Worker 3: Processa requisiÃ§Ãµes 3, 7, 11, 15...
Worker 4: Processa requisiÃ§Ãµes 4, 8, 12, 16...

// Resultado: 4x mais requisiÃ§Ãµes simultÃ¢neas! ğŸš€
```

## ğŸ“Š **Monitoramento na PrÃ¡tica**

### **ğŸ¯ MÃ©tricas que Realmente Importam**

Acesse `https://localhost:3000/metrics` e vocÃª vai ver:

```prometheus
# SaÃºde do sistema
nodejs_eventloop_lag_seconds          # Se estiver alto, tem problema
nodejs_process_cpu_seconds_total      # Uso de CPU
nodejs_process_resident_memory_bytes  # MemÃ³ria consumida

# Performance da aplicaÃ§Ã£o  
http_requests_total                   # Quantas requests por segundo
http_request_duration_seconds         # Tempo mÃ©dio de resposta
auth_failed_logins_total              # Tentativas de invasÃ£o
```

### **ï¿½ Dashboard de SeguranÃ§a (Meu Orgulho)**

ConstruÃ­ endpoints prÃ³prios porque as ferramentas prontas nunca fazem exatamente o que vocÃª precisa:

- `GET /security/stats` - EstatÃ­sticas em tempo real
- `GET /security/report` - RelatÃ³rio detalhado com recomendaÃ§Ãµes  
- `GET /security/events` - Ãšltimos eventos de seguranÃ§a
- `GET /security/threats` - AnÃ¡lise de ameaÃ§as ativas
- `GET /security/health` - Status dos sistemas de seguranÃ§a

### **ï¿½ Logs que Fazem Sentido**

```bash
# Acompanhar em tempo real
pm2 logs autenticacao --lines 100

# Exemplo do que vocÃª vai ver:
ğŸ“¥ [Worker 12345] POST /login processado em 45ms
ï¿½ [Security] IP 192.168.1.100 bloqueado - tentativas de SQLi
âœ… [Auth] Login bem-sucedido para usuÃ¡rio: admin
ğŸ“Š [Metrics] Request rate: 250/min, Error rate: 0.2%
```

## ğŸ§ª **Testes que Funcionam**

Acredito que teste bom Ã© teste que falha quando deve falhar. Aqui temos:

### **ğŸ“‹ O que EstÃ¡ Coberto**

**Testes UnitÃ¡rios (50 testes)**
- LÃ³gica de negÃ³cio isolada
- ValidaÃ§Ãµes de entrada  
- TransformaÃ§Ãµes de dados
- Casos extremos e edge cases

**Testes de IntegraÃ§Ã£o (16 testes)**
- Fluxo completo de autenticaÃ§Ã£o
- IntegraÃ§Ã£o com banco de dados
- SeguranÃ§a de endpoints
- ValidaÃ§Ã£o de headers

**Testes de Carga (Artillery)**
- 4.000+ logins simultÃ¢neos
- DistribuiÃ§Ã£o entre workers
- Comportamento sob stress
- Rate limiting real

### **ğŸš€ Como Executar**

```bash
# Executar tudo (minha preferÃªncia para CI)
npm run test:all

# Apenas unitÃ¡rios (rÃ¡pido para desenvolvimento)  
npm run test:unit

# Apenas integraÃ§Ã£o (quando mudo APIs)
npm run test:integration

# Teste de carga (final de sprint)
npm run test:load

# Cobertura de cÃ³digo (para ver o que falta)
npm run test:coverage
```

### **ğŸ’¡ Dica Importante**
Os testes rodam com `NODE_ENV=test` e usam MongoDB em memÃ³ria. Ou seja, nÃ£o vÃ£o bagunÃ§ar seu ambiente de desenvolvimento.

## âœ… **STATUS DO PROJETO**

### **ğŸ¯ Sistema Pronto para ProduÃ§Ã£o**
- âœ… **66 testes automatizados** (100% passando)
  - 50 testes unitÃ¡rios
  - 16 testes de integraÃ§Ã£o  
  - Testes de carga (4.000+ requisiÃ§Ãµes simultÃ¢neas)
- âœ… **Arquitetura hexagonal** implementada
- âœ… **SeguranÃ§a corporativa** avanÃ§ada
- âœ… **Clustering** com 4 workers
- âœ… **Monitoramento** completo
- âœ… **DocumentaÃ§Ã£o** Swagger

### **ğŸ“Š MÃ©tricas de Performance**
```
âœ… Core isolado com DI
âœ… Adapters implementados  
âœ… Bootstrap funcional
âœ… ConfiguraÃ§Ã£o centralizada
âœ… Zero dependÃªncias circulares
âœ… Rate limiting: IP + Login + Global
âœ… DetecÃ§Ã£o de ameaÃ§as: XSS, SQLi, DDoS
âœ… Dashboard: 6 endpoints REST
```

---

## ğŸ¤ **Contribuindo**

Encontrou um bug? Tem uma sugestÃ£o? Abra uma issue ou faÃ§a um pull request. Feedback Ã© sempre bem-vindo!

## ğŸ“„ **LicenÃ§a**

MIT License - sinta-se livre para usar este cÃ³digo em seus projetos.

---

**Desenvolvido por Dioney Froes** | Junho - Julho 2025 | Com GitHub Copilot  
ğŸš€ *Transformando ideias em cÃ³digo que funciona*
